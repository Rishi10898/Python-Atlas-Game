<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Color Tag Game</title>
<style>
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: linear-gradient(to bottom right, #0f172a, #5b21b6);
    color: white;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
  }
  canvas {
    border: 4px solid #8b5cf6;
    border-radius: 12px;
    display: block;
    margin-top: 20px;
  }
  #menu { text-align: center; }
  button {
    padding: 10px 20px;
    background-color: #8b5cf6;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    margin: 10px;
  }
  button:hover { background-color: #7c3aed; }
</style>
</head>
<body>

<div id="menu">
  <h1>ðŸŽ¯ Color Tag Game</h1>
  <label for="arena">Select Arena:</label>
  <select id="arena">
    <option value="forest">Forest</option>
    <option value="snow">Snow</option>
    <option value="desert">Desert</option>
    <option value="city">City</option>
    <option value="beach">Beach</option>
  </select>
  <br>
  <button onclick="startGame(1)">Single Player</button>
  <button onclick="startGame(2)">Two Players</button>
  <button onclick="startGame(3)">Three Players</button>
  <button onclick="startGame(4)">Four Players</button>
</div>

<canvas id="gameCanvas" width="900" height="650"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

const PLAYER_RADIUS = 20;
const PLAYER_SPEED = 4;
const COLORS = ['#ef4444', '#3b82f6', '#22c55e', '#eab308', '#a855f7'];
const POWER_UP_TYPES = ['speed','shield','freeze','teleport'];

let players = [];
let powerUps = [];
let keysPressed = {};
let gameRunning = false;
let gameTime = 60;
let winner = null;
let arena = 'forest';

// Keyboard input
window.addEventListener('keydown', e => keysPressed[e.key.toLowerCase()] = true);
window.addEventListener('keyup', e => keysPressed[e.key.toLowerCase()] = false);

// Utility
function random(min,max){ return Math.random()*(max-min)+min; }

// Start game
function startGame(playerCount) {
  document.getElementById('menu').style.display = 'none';
  players = [];
  powerUps = [];
  winner = null;
  gameTime = 60;
  arena = document.getElementById('arena').value;
  gameRunning = true;

  for(let i=0;i<playerCount;i++){
    const angle = (i / playerCount) * Math.PI*2;
    const radius = 200;
    players.push({
      x: canvas.width/2 + Math.cos(angle)*radius,
      y: canvas.height/2 + Math.sin(angle)*radius,
      color: COLORS[i],
      isIt: i===0,
      vx:0, vy:0,
      emoji: ['ðŸ˜Ž','ðŸ§¢','ðŸ‘¾','ðŸ¤–'][i],
      invincible: false,
      invincibleTime: 0
    });
  }

  spawnPowerUp();
  requestAnimationFrame(gameLoop);
  setInterval(() => { if(gameRunning){ gameTime--; if(gameTime<=0) gameRunning=false; } },1000);
}

// Spawn random power-up
function spawnPowerUp(){
  if(!gameRunning) return;
  if(powerUps.length>=3) return;
  powerUps.push({
    x: random(50,canvas.width-50),
    y: random(50,canvas.height-50),
    type: POWER_UP_TYPES[Math.floor(Math.random()*POWER_UP_TYPES.length)],
    active: true
  });
  setTimeout(spawnPowerUp,5000);
}

// Game loop
function gameLoop(){
  if(!gameRunning){ drawGame(); drawWinner(); return; }

  // Move players
  players.forEach((p,idx)=>{
    if(idx===0){ // Player1 WASD
      p.vx = (keysPressed['d']?PLAYER_SPEED:0) - (keysPressed['a']?PLAYER_SPEED:0);
      p.vy = (keysPressed['s']?PLAYER_SPEED:0) - (keysPressed['w']?PLAYER_SPEED:0);
    } else if(idx===1){ // Player2 Arrows
      p.vx = (keysPressed['arrowright']?PLAYER_SPEED:0) - (keysPressed['arrowleft']?PLAYER_SPEED:0);
      p.vy = (keysPressed['arrowdown']?PLAYER_SPEED:0) - (keysPressed['arrowup']?PLAYER_SPEED:0);
    } else { // AI chases nearest human
      const human = players[0];
      const dx = human.x - p.x;
      const dy = human.y - p.y;
      const dist = Math.sqrt(dx*dx+dy*dy);
      p.vx = dx/dist*2;
      p.vy = dy/dist*2;
    }
    p.x += p.vx;
    p.y += p.vy;
    // bounds
    p.x = Math.max(PLAYER_RADIUS,Math.min(canvas.width-PLAYER_RADIUS,p.x));
    p.y = Math.max(PLAYER_RADIUS,Math.min(canvas.height-PLAYER_RADIUS,p.y));
  });

  // Collisions between players
  for(let i=0;i<players.length;i++){
    for(let j=i+1;j<players.length;j++){
      const dx = players[i].x-players[j].x;
      const dy = players[i].y-players[j].y;
      const dist = Math.sqrt(dx*dx+dy*dy);
      if(dist<PLAYER_RADIUS*2){
        if(players[i].isIt && !players[j].invincible){ players[j].isIt=true; players[i].isIt=false; players[j].invincible=true; players[j].invincibleTime=Date.now()+1000; }
        else if(players[j].isIt && !players[i].invincible){ players[i].isIt=true; players[j].isIt=false; players[i].invincible=true; players[i].invincibleTime=Date.now()+1000; }
      }
    }
  }

  // Power-up collection
  powerUps.forEach(pu=>{
    if(!pu.active) return;
    players.forEach(pl=>{
      const dx = pl.x-pu.x;
      const dy = pl.y-pu.y;
      if(Math.sqrt(dx*dx+dy*dy)<PLAYER_RADIUS+15){
        applyPowerUp(pl,pu.type);
        pu.active=false;
      }
    });
  });

  powerUps = powerUps.filter(pu=>pu.active);

  drawGame();
  requestAnimationFrame(gameLoop);
}

// Apply power-up
function applyPowerUp(player,type){
  switch(type){
    case 'speed': player.vx*=2; player.vy*=2; setTimeout(()=>{player.vx/=2;player.vy/=2},3000); break;
    case 'shield': player.invincible=true; player.invincibleTime=Date.now()+3000; break;
    case 'freeze': players.forEach(p=>{if(p!==player)p.vx=0;p.vy=0}); setTimeout(()=>{},2000); break;
    case 'teleport': player.x=random(50,canvas.width-50); player.y=random(50,canvas.height-50); break;
  }
}

// Draw everything
function drawGame(){
  // Arena background
  const bgColors = {forest:'#14532d',snow:'#e0f2fe',desert:'#fcd34d',city:'#334155',beach:'#facc15'};
  ctx.fillStyle = bgColors[arena]||'#1e293b';
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Draw power-ups
  powerUps.forEach(pu=>{
    ctx.fillStyle='#fbbf24';
    ctx.beginPath();
    ctx.arc(pu.x,pu.y,15,0,Math.PI*2);
    ctx.fill();
    const icons = {'speed':'âš¡','shield':'ðŸ›¡ï¸','freeze':'â„ï¸','teleport':'âœ¨'};
    ctx.fillStyle='black';
    ctx.font='20px Arial';
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.fillText(icons[pu.type],pu.x,pu.y);
  });

  // Draw players
  const now = Date.now();
  players.forEach(p=>{
    ctx.font='30px Arial';
    ctx.textAlign='center';
    ctx.textBaseline='middle';
    ctx.globalAlpha = (p.invincible && p.invincibleTime>now)?0.5:1;
    ctx.fillText(p.emoji,p.x,p.y);
    ctx.globalAlpha=1;
    if(p.isIt){
      ctx.strokeStyle='#fbbf24';
      ctx.lineWidth=3;
      ctx.beginPath();
      ctx.arc(p.x,p.y,PLAYER_RADIUS+5,0,Math.PI*2);
      ctx.stroke();
    }
    if(p.invincible && p.invincibleTime<now) p.invincible=false;
  });

  // Timer
  ctx.fillStyle='white';
  ctx.font='24px Arial';
  ctx.fillText(`Time: ${gameTime}s`,20,30);
}

// Winner
function drawWinner(){
  const itPlayer = players.find(p=>p.isIt);
  if(!itPlayer) return;
  ctx.fillStyle='white';
  ctx.font='48px Arial';
  ctx.fillText(`ðŸŽ‰ ${itPlayer.emoji} is IT! ðŸŽ‰`,canvas.width/2-150,canvas.height/2);
  const btn = document.createElement('button');
  btn.innerText='Play Again';
  btn.onclick=()=>location.reload();
  document.body.appendChild(btn);
}
</script>
</body>
</html>
