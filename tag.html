<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TAG Game Clone</title>
<style>
  body { margin: 0; font-family: sans-serif; background: #111; color: #fff; display: flex; flex-direction: column; align-items: center; }
  canvas { border-radius: 10px; margin-top: 10px; }
  #scoreboard { display: flex; justify-content: center; gap: 20px; margin-top: 10px; font-size: 18px; }
  .playerScore { padding: 5px 10px; border-radius: 5px; }
  .red { background: red; } 
  .blue { background: blue; } 
  .green { background: green; } 
  .purple { background: purple; } 
  .yellow { background: yellow; color: #000; }
  #mapSelect { margin-top: 10px; font-size: 16px; padding: 5px; border-radius: 5px; }
</style>
</head>
<body>
<h1>TAG Game Clone</h1>
<select id="mapSelect">
  <option value="forest">Forest</option>
  <option value="desert">Desert</option>
  <option value="snow">Snow</option>
</select>
<div id="scoreboard">
  <div id="score1" class="playerScore red">Red: 0</div>
  <div id="score2" class="playerScore blue">Blue: 0</div>
  <div id="score3" class="playerScore green">Green: 0</div>
  <div id="score4" class="playerScore purple">Purple: 0</div>
</div>
<canvas id="game" width="800" height="600"></canvas>
<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

let currentMap = 'forest';

document.getElementById('mapSelect').addEventListener('change', (e)=>{
  currentMap = e.target.value;
});

// Players
const players = [
  { x: 50, y: 50, color: 'red', up:'w', down:'s', left:'a', right:'d', speed: 4, isIt: true, score: 0, teleport: 3 },
  { x: 750, y: 50, color: 'blue', up:'ArrowUp', down:'ArrowDown', left:'ArrowLeft', right:'ArrowRight', speed: 4, isIt: false, score: 0, teleport: 3 },
  { x: 50, y: 550, color: 'green', up:'i', down:'k', left:'j', right:'l', speed: 4, isIt: false, score: 0, teleport: 3 },
  { x: 750, y: 550, color: 'purple', up:'t', down:'g', left:'f', right:'h', speed: 4, isIt: false, score: 0, teleport: 3 }
];

const keys = {};
document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

// Teleport keys: Q, M, U, R
const teleportKeys = ['q','m','u','r'];

function update() {
  players.forEach((p, idx) => {
    if(keys[p.up]) p.y -= p.speed;
    if(keys[p.down]) p.y += p.speed;
    if(keys[p.left]) p.x -= p.speed;
    if(keys[p.right]) p.x += p.speed;

    // Teleport
    if(keys[teleportKeys[idx]] && p.teleport>0){
      p.x = Math.random()*(canvas.width-40)+20;
      p.y = Math.random()*(canvas.height-40)+20;
      p.teleport--;
      keys[teleportKeys[idx]] = false;
    }

    // Keep inside canvas
    p.x = Math.max(20, Math.min(canvas.width - 20, p.x));
    p.y = Math.max(20, Math.min(canvas.height - 20, p.y));
  });

  // Tag logic
  const itPlayer = players.find(p => p.isIt);
  players.forEach(p => {
    if(p !== itPlayer){
      const dx = itPlayer.x - p.x;
      const dy = itPlayer.y - p.y;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if(dist < 30){
        itPlayer.isIt = false;
        p.isIt = true;
        p.score++;
        updateScores();
      }
    }
  });
}

function updateScores(){
  players.forEach((p,i)=>{
    const el = document.getElementById('score'+(i+1));
    el.textContent = `${capitalize(p.color)}: ${p.score} (${p.teleport} TP)`;
    el.className = `playerScore ${p.isIt?'yellow':p.color}`;
  });
}

function capitalize(str){ return str.charAt(0).toUpperCase() + str.slice(1); }

function drawMap(){
  if(currentMap==='forest') ctx.fillStyle='#228B22';
  if(currentMap==='desert') ctx.fillStyle='#DEB887';
  if(currentMap==='snow') ctx.fillStyle='#ADD8E6';
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function drawPlayers(){
  players.forEach(p=>{
    ctx.fillStyle = p.isIt?'yellow':p.color;
    ctx.beginPath();
    ctx.arc(p.x,p.y,20,0,Math.PI*2);
    ctx.fill();
    // Face
    ctx.fillStyle = '#000';
    ctx.beginPath();
    ctx.arc(p.x-7,p.y-5,3,0,Math.PI*2);
    ctx.arc(p.x+7,p.y-5,3,0,Math.PI*2);
    ctx.fill();
    ctx.beginPath();
    ctx.arc(p.x,p.y+5,8,0,Math.PI);
    ctx.stroke();
  });
}

function gameLoop(){
  drawMap();
  update();
  drawPlayers();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
